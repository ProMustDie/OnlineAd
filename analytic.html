<!doctype html>
<html lang="en">

<head>
    <title>Title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS v5.2.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

</head>

<body>



    <div class="container-fluid m-0 p-0">

        <nav class="navbar navbar-expand-lg bg-dark ">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#"><button type="button"
                                    class="btn btn-outline-light" onclick="exportLineChartsToPDF()">Export Line
                                    Charts
                                    to PDF</button></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><button type="button" class="btn btn-outline-light"
                                    onclick="exportTablesToExcel()">Export Table to
                                    Excel</button></a>
                        </li>
                    </ul>
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#"> <button type="button" class="btn btn-outline-light"
                                    onclick="changeData('daily')">Daily</button>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><button type="button" class="btn btn-outline-light"
                                    onclick="changeData('weekly')">Weekly</button>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"><button type="button" class="btn btn-outline-light"
                                    onclick="changeData('monthly')">Monthly</button>
                            </a>
                        </li>
                    </ul>
                    <form class="d-flex" role="search">
                        <button class="btn btn-dark me-1 fs-5" type="submit" disabled>Calender: </button>
                        <input type="text" name="daterange" class="form-control w-75 d-inline" />
                    </form>
                </div>
            </div>
        </nav>

        <div class="row m-1 mb-3 gy-2 gx-2 d-flex">
            <div class="col-lg-6">
                <canvas id="UserReq"></canvas>
            </div>

            <div class="col-lg-6">
                <canvas id="AcceptRej"></canvas>
            </div>
        </div>


        <div class="row m-1 mb-3 gy-2 gx-2 d-flex">
            <div class="col-lg-6 bg-light">
                <div class="table-responsive" style="height: 26rem;">
                    <table class="table caption-top table-striped table-hover table-bordered border-secondary table-sm"
                        id="UserTable">
                        <caption class="text-dark">Recent Ads Requested (31 Days)</caption>
                        <thead class="table-dark">
                            <tr>
                                <th scope="col">#</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">AdName</th>
                                    <th scope="col">AdCategory</th>
                                    <th scope="col">AdPrice</th>
                                    <th scope="col">AdStatus</th>
                                    <th scope="col">Request Date</th>
                                    <th scope="col">Approved Date</th>
                            </tr>
                        </thead>
                        <tbody class="table-group-divider">
                            <?php
                            $result = $classified->getAds31days();
                            if (mysqli_num_rows($result) > 0) :
                                $counter = 1;
                                while ($ads = $result->fetch_assoc()) {
                            ?>
                            <tr>
                                <th scope="row"><?= $counter?></th>
                                <td><?= $ads['UserName'] ?></td>
                                <td><?= $ads['AdName'] ?></td>
                                <td><?= $ads['AdCategory'] ?></td>
                                <td><?= (empty($ads['Price']))?"Not Set":$ads['Price']; ?></td>
                                <td><?= $ads['AdStatus'] ?></td>
                                <td><?= $ads['AdRequestedDate'] ?></td>
                                <td><?= (empty($ads['AdApprovedDate']))?"Not Yet Approved":$ads['AdApprovedDate']; ?></td>
                            </tr>

                            <?php $counter++; }endif;
                            ?>
                            
                            
                        </tbody>

                    </table>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="row m-0">
                    <div class="col-lg-7" style="height: 26rem;">
                        <canvas id="Sales"></canvas>
                    </div>
                    <div class="col-lg-5">
                        <div class="table-responsive" style="height: 26rem;">
                            <table
                                class="table caption-top table-striped table-hover table-bordered border-secondary table-sm"
                                id="SalesTable">
                                <caption>Sales</caption>
                                <thead class="table-dark">
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">AdCategory</th>
                                        <th scope="col">Chosen</th>
                                        <th scope="col">Sales</th>
                                    </tr>
                                </thead>
                                <tbody class="table-group-divider">
                                    <?php 
                                    $categoriesData = $classified->getCategories();
                                    $catResult = $categoriesData['result'];
    
                                    if (mysqli_num_rows($catResult) > 0) :
                                        $counter=1;
                                        while ($categories = $catResult->fetch_assoc()) {
                                            $categoryName = $categories["Category"];
                                    ?>
                                        <tr>
                                            <th scope="row"><?=$counter?></th>
                                            <td><?=$categoryName?></td>
                                            <td>Otto</td>
                                            <td>@mdo</td>
                                        </tr>
    
                                    <?php $counter++; }endif;?>
                                </tbody>

                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <table class="table caption-top table-striped table-hover table-bordered border-secondary table-sm" id="Shortcut">
        <caption>Sales</caption>
        <thead class="table-dark">
            <tr>
                <th scope="col">#</th>
                <th scope="col">Shortcut Keys / Steps</th>
                <th scope="col">function</th>

            </tr>
        </thead>
        <tbody class="table-group-divider">
            <tr>
                <th scope="row">1</th>
                <td>=subtotal(3,</td>
                <td>Count total amount before and after filter.</td>
            </tr>
            <tr>
                <th scope="row">2</th>
                <td>right click on date header, go to select option and select 'Entire Table Column', go to data and
                    select 'Text to column', click next to Step 3 and Choose date and select the format you want.</td>
                <td>Change date format to dd/mm/yyyy</td>
            </tr>
            <tr>
                <th scope="row">3</th>
                <td>=countif('select start of data' : then ctrl + shift + 'down arrow key'/or select entire column, 'select start of data') .
                    When it is done, click on the first and second part and press f4 /// To double check, =countif(
                    'select start of data': 'select start of data', 'select start of data').. in the first data, add '$'
                    in between</td>
                <td>Get dulpicate data // double confirm the data</td>
            </tr>
        </tbody>

    </table>
    </div>






    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous">
        </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous">
        </script>
    <!-- Bootstrap JavaScript Libraries -->

    <!-- //!Export Data -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <!-- //!Export Data -->

    <!-- //!Chartjs-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- //!Chartjs-->

    <script>
        const UserReq = document.getElementById('UserReq');
        const AcceptRej = document.getElementById('AcceptRej');
        const Sales = document.getElementById('Sales');

        new Chart(UserReq, {
            type: 'line',
            data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: '# of Users',
                    data: [12, 19, 3, 5, 2, 3],
                    borderWidth: 1
                }, {
                    label: '# of Requests',
                    data: [2, 9, 13, 15, 12, 13],
                    borderWidth: 1
                }]
            },
            options: {
                interaction: {
                    intersect: false,
                    mode: 'index',
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }, plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    title: {
                        display: true,
                        text: 'New Users / Requested Inquiries'
                    }
                },
            }
        });

        new Chart(AcceptRej, {
            type: 'line',
            data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: '# of Users',
                    data: [12, 19, 3, 5, 2, 3],
                    borderWidth: 1
                }, {
                    label: '# of Requests',
                    data: [2, 9, 13, 15, 12, 13],
                    borderWidth: 1
                }]
            },
            options: {
                interaction: {
                    intersect: false,
                    mode: 'index',
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }, plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    title: {
                        display: true,
                        text: 'Accept / Rejected Inquiries'
                    }
                },
            }
        });

        new Chart(Sales, {
            type: 'pie',
            data: {
                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [{
                    label: 'Sales',
                    data: [12, 19, 3, 5, 2, 3],
                    borderWidth: 1
                }]
            },
            options: {
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    title: {
                        display: true,
                        text: 'Sales Chart'
                    }
                },

            }
        });

        // Function to export line charts to PDF using jspdf
        function exportLineChartsToPDF() {
            // Create a new jsPDF instance with a larger page (A2)
            var pdf = new jspdf.jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: [594, 420], // A2 size in landscape
            });

            // Get the canvas elements
            var canvas1 = document.getElementById('UserReq');
            var canvas2 = document.getElementById('AcceptRej');
            var canvas3 = document.getElementById('Sales');

            // Convert the canvases to images
            var imgData1 = canvas1.toDataURL('image/jpeg', 1.0);
            var imgData2 = canvas2.toDataURL('image/jpeg', 1.0);
            var imgData3 = canvas3.toDataURL('image/jpeg', 1.0);

            // Calculate the height as 30% of the PDF page
            var pageHeight = pdf.internal.pageSize.getHeight();
            var height = pageHeight * 0.3;

            // Add the images to the PDF side by side, filling up the entire width
            var padding = 10; // Adjust the padding value as needed
            var width = pdf.internal.pageSize.getWidth() / 2 - padding * 2;

            pdf.addImage(imgData1, 'JPEG', padding, padding, width, height);
            pdf.addImage(imgData2, 'JPEG', width + padding * 2, padding, width, height);

            // Extra space for the pie chart
            var extraSpace = 10;

            // Add the pie chart to the PDF below the line charts
            pdf.addImage(imgData3, 'JPEG', padding, height + padding * 2 + extraSpace, pdf.internal.pageSize.getWidth() - padding * 2, height);

            // Display values below the line charts
            var extraSpaceLineCharts = 20;

            // Save the PDF
            pdf.save('lineCharts.pdf');
        }

        // Function to export Bootstrap tables to Excel using xlsx
        function exportTablesToExcel() {
            // Get the Table elements
            var tableSales = document.getElementById('SalesTable');
            var tableUser = document.getElementById('UserTable');
            var Shortcut = document.getElementById('Shortcut');

            // Create a workbook
            var wb = XLSX.utils.book_new();

            // Convert each table to a worksheet
            var wsSales = XLSX.utils.table_to_sheet(tableSales);
            var wsUser = XLSX.utils.table_to_sheet(tableUser);
            var wsShortcut = XLSX.utils.table_to_sheet(Shortcut);

            // Add each worksheet to the workbook with a unique name
            XLSX.utils.book_append_sheet(wb, wsSales, "SalesSheet");
            XLSX.utils.book_append_sheet(wb, wsUser, "UserSheet");
            XLSX.utils.book_append_sheet(wb, wsShortcut, "Shortcut");

            // Save the workbook as an Excel file
            XLSX.writeFile(wb, 'tablesData.xlsx');
        }


    </script>


</body>

</html>